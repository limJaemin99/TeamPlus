<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{project-index-layout}">

<th:block layout:fragment="pagetitle">
	<!--page title-->
	<div th:replace="partials/title-meta :: title-meta('TODO READ')"></div>
</th:block>

<head>
	<!-- Dragula css -->
	<link rel="stylesheet" href="/assets/libs/dragula/dragula.min.css" />
	<!-- jQuery -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<!-- Bootstrap JS (Popper.js 포함) -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/js/bootstrap.bundle.min.js"></script>

</head>

<body>
	<div layout:fragment="content">
		<div th:replace="partials/page-title :: page-title('TODO LIST','TODO')"></div>

		<div class="tasks-board mb-3" id="kanbanboard" style="padding-bottom: 50px;">
			<div class="tasks-list">
				<div class="d-flex mb-3">
					<div class="flex-grow-1">
						<input type="hidden" name="status" value="3">
						<h6 class="fs-14 text-uppercase fw-semibold mb-0">NEW <small
								class="badge bg-secondary align-bottom ms-1 totaltask">[[${count3}]]</small></h6>
					</div>
				</div>
				<div data-simplebar class="tasks-wrapper px-3 mx-n3" style="max-height: calc(100vh - 300px)">
					<div id="unassigned-task" class="tasks">
						<div class="card tasks-box" th:each="vo : ${list3}">
							<input type="hidden" name="todoNo" th:value="${vo.todoNo}">
							<div class="card-body">
								<div class="d-flex mb-2">
									<h6 class="fs-15 mb-0 flex-grow-1 text-truncate task-title" th:value="${vo.title}"><a
											href="/apps-tasks-details" class="d-block">[[${vo.title}]]</a>
									</h6>
									<div class="dropdown">
										<a href="javascript:void(0);" class="text-muted" id="dropdownMenuLink1"
											data-bs-toggle="dropdown" aria-expanded="false"><i
												class="ri-more-fill"></i></a>
										<ul class="dropdown-menu" aria-labelledby="dropdownMenuLink1">
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#todotaskModal"><i
														class="ri-eye-fill align-bottom me-2 text-muted"></i> View</a>
											</li>
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#todotaskModal"><i
														class="ri-edit-2-line align-bottom me-2 text-muted"></i>
													Edit</a></li>
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
													href="#deleteRecordModal" id="delete"><i
														class="ri-delete-bin-5-line align-bottom me-2 text-muted"></i>
													Delete</a></li>
										</ul>
									</div>
								</div>
								<p class="text-muted" th:value="${vo.description}">[[${vo.description}]]</p>
								<div class="mb-3">
									<div class="d-flex mb-1">
										<div class="flex-grow-1">
											<h6 class="text-muted mb-0"><span class="text-secondary">15%</span> of 100%
											</h6>
										</div>
										<div class="flex-shrink-0">
											<span class="text-muted" th:value="${vo.todoDate}">[[${vo.todoDate}]]</span>
										</div>
									</div>
									<div class="progress rounded-3 progress-sm">
										<div class="progress-bar bg-secondary" role="progressbar" style="width: 15%"
											aria-valuenow="15" aria-valuemin="0" aria-valuemax="100"></div>
									</div>
								</div>
							</div>
							<!--end card-body-->
						</div>
					</div>
					<!--end tasks-->
				</div>
				<div class="my-3">
					<button class="btn btn-soft-info w-100" data-bs-toggle="modal"
						data-bs-target="#creatertaskModal">Add More</button>
				</div>
			</div>
			<!--end tasks-list-->
			<div class="tasks-list">
				<div class="d-flex mb-3">
					<div class="flex-grow-1">
						<input type="hidden" name="status" value="0">
						<h6 class="fs-14 text-uppercase fw-semibold mb-0">진행전 <small
								class="badge bg-success align-bottom ms-1 totaltask-badge">[[${count0}]]</small></h6>
					</div>
				</div>
				<div data-simplebar class="tasks-wrapper px-3 mx-n3" style="max-height: calc(100vh - 300px)">
					<div id="todo-task" class="tasks">
						<div class="card tasks-box" th:each="vo : ${list0}">
							<input type="hidden" name="todoNo" th:value="${vo.todoNo}">
							<div class="card-body">
								<div class="d-flex mb-2">
									<h6 class="fs-15 mb-0 flex-grow-1 text-truncate task-title" th:value="${vo.title}"><a
											href="/apps-tasks-details" class="d-block">[[${vo.title}]]</a>
									</h6>
									<div class="dropdown">
										<a href="javascript:void(0);" class="text-muted" id="dropdownMenuLink3"
										   data-bs-toggle="dropdown" aria-expanded="false"><i
												class="ri-more-fill"></i></a>
										<ul class="dropdown-menu" aria-labelledby="dropdownMenuLink1">
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#todotaskModal"><i
													class="ri-eye-fill align-bottom me-2 text-muted"></i> View</a>
											</li>
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#todotaskModal"><i
													class="ri-edit-2-line align-bottom me-2 text-muted"></i>
												Edit</a></li>
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#deleteRecordModal"><i
													class="ri-delete-bin-5-line align-bottom me-2 text-muted"></i>
												Delete</a></li>
										</ul>
									</div>
								</div>
								<p class="text-muted" th:value="${vo.description}">[[${vo.description}]]</p>
								<div class="mb-3">
									<div class="d-flex mb-1">
										<div class="flex-grow-1">
											<h6 class="text-muted mb-0"><span class="text-secondary">30%</span> of 100%
											</h6>
										</div>
										<div class="flex-shrink-0">
											<span class="text-muted" th:value="${vo.todoDate}">[[${vo.todoDate}]]</span>
										</div>
									</div>
									<div class="progress rounded-3 progress-sm">
										<div class="progress-bar bg-success" role="progressbar" style="width: 30%"
											 aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
									</div>
								</div>
							</div>
							<!--end card-body-->
						</div>
					</div>
					<!--end tasks-->
				</div>
			</div>
			<!--end tasks-list-->
			<div class="tasks-list">
				<div class="d-flex mb-3">
					<div class="flex-grow-1">
						<input type="hidden" name="status" value="2">
						<h6 class="fs-14 text-uppercase fw-semibold mb-0">진행중 <small
								class="badge bg-warning align-bottom ms-1 totaltask-badge">[[${count2}]]</small></h6>
					</div>
				</div>
				<div data-simplebar class="tasks-wrapper px-3 mx-n3" style="max-height: calc(100vh - 300px)">
					<div id="inprogress-task" class="tasks">
						<div class="card tasks-box" th:each="vo : ${list2}">
							<input type="hidden" name="todoNo" th:value="${vo.todoNo}">
							<div class="card-body">
								<div class="d-flex mb-2">
									<h6 class="fs-15 mb-0 flex-grow-1 text-truncate task-title" th:value="${vo.title}"><a
											href="/apps-tasks-details" class="d-block">[[${vo.title}]]</a>
									</h6>
									<div class="dropdown">
										<a href="javascript:void(0);" class="text-muted" id="dropdownMenuLink5"
										   data-bs-toggle="dropdown" aria-expanded="false"><i
												class="ri-more-fill"></i></a>
										<ul class="dropdown-menu" aria-labelledby="dropdownMenuLink1">
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#todotaskModal"><i
													class="ri-eye-fill align-bottom me-2 text-muted"></i> View</a>
											</li>
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#todotaskModal"><i
													class="ri-edit-2-line align-bottom me-2 text-muted"></i>
												Edit</a></li>
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#deleteRecordModal"><i
													class="ri-delete-bin-5-line align-bottom me-2 text-muted"></i>
												Delete</a></li>
										</ul>
									</div>
								</div>
								<p class="text-muted" th:value="${vo.description}">[[${vo.description}]]</p>
								<div class="mb-3">
									<div class="d-flex mb-1">
										<div class="flex-grow-1">
											<h6 class="text-muted mb-0"><span class="text-secondary">60%</span> of 100%
											</h6>
										</div>
										<div class="flex-shrink-0">
											<span class="text-muted" th:value="${vo.todoDate}">[[${vo.todoDate}]]</span>
										</div>
									</div>
									<div class="progress rounded-3 progress-sm">
										<div class="progress-bar bg-warning" role="progressbar" style="width: 60%"
											 aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
									</div>
								</div>
							</div>
							<!--end card-body-->
						</div>
					</div>
					<!--end tasks-->
				</div>
			</div>
			<!--end tasks-list-->
			<div class="tasks-list">
				<div class="d-flex mb-3">
					<div class="flex-grow-1">
						<input type="hidden" name="status" value="1">
						<h6 class="fs-14 text-uppercase fw-semibold mb-0">완료 <small
								class="badge bg-danger align-bottom ms-1 totaltask-badge">[[${count4}]]</small></h6>
					</div>
				</div>
				<div data-simplebar class="tasks-wrapper px-3 mx-n3" style="max-height: calc(100vh - 300px)">
					<div id="reviews-task" class="tasks">
						<div class="card tasks-box" th:each="vo : ${list4}">
							<input type="hidden" name="todoNo" th:value="${vo.todoNo}">
							<div class="card-body">
								<div class="d-flex mb-2">
									<h6 class="fs-15 mb-0 flex-grow-1 text-truncate task-title"><a
											href="/apps-tasks-details" class="d-block" th:value="${vo.title}">[[${vo.title}]]</a>
									</h6>
									<div class="dropdown">
										<a href="javascript:void(0);" class="text-muted" id="dropdownMenuLink7"
										   data-bs-toggle="dropdown" aria-expanded="false"><i
												class="ri-more-fill"></i></a>
										<ul class="dropdown-menu" aria-labelledby="dropdownMenuLink1">
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#todotaskModal"><i
													class="ri-eye-fill align-bottom me-2 text-muted"></i> View</a>
											</li>
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#todotaskModal"><i
													class="ri-edit-2-line align-bottom me-2 text-muted"></i>
												Edit</a></li>
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#deleteRecordModal"><i
													class="ri-delete-bin-5-line align-bottom me-2 text-muted"></i>
												Delete</a></li>
										</ul>
									</div>
								</div>
								<p class="text-muted" th:value="${vo.description}">[[${vo.description}]]</p>
								<div class="mb-3">
									<div class="d-flex mb-1">
										<div class="flex-grow-1">
											<h6 class="text-muted mb-0"><span class="text-secondary">100%</span> of 100%
											</h6>
										</div>
										<div class="flex-shrink-0">
											<span class="text-muted" th:value="${vo.todoDate}">[[${vo.todoDate}]]</span>
										</div>
									</div>
									<div class="progress rounded-3 progress-sm">
										<div class="progress-bar bg-danger" role="progressbar" style="width: 100%"
											 aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
									</div>
								</div>
							</div>
							<!--end card-body-->
						</div>
					</div>
					<!--end tasks-->
				</div>
			</div>
			<div class="tasks-list">
				<div class="d-flex mb-3">
					<div class="flex-grow-1">
						<input type="hidden" name="status" value="1">
						<h6 class="fs-14 text-uppercase fw-semibold mb-0">지난 TODO<small
								class="badge bg-dark align-bottom ms-1 totaltask-badge">[[${count1}]]</small></h6>
					</div>
				</div>
				<div data-simplebar class="tasks-wrapper px-3 mx-n3" style="max-height: calc(100vh - 300px)">
					<div id="new-task" class="tasks">
						<div class="card tasks-box" th:each="vo : ${list1}">
							<input type="hidden" name="todoNo" th:value="${vo.todoNo}">
							<div class="card-body">
								<div class="d-flex mb-2">
									<h6 class="fs-15 mb-0 flex-grow-1 text-truncate task-title"><a
											href="/apps-tasks-details" class="d-block" th:value="${vo.title}">[[${vo.title}]]</a>
									</h6>
									<div class="dropdown">
										<a href="javascript:void(0);" class="text-muted" id="dropdownMenuLink2"
										   data-bs-toggle="dropdown" aria-expanded="false"><i
												class="ri-more-fill"></i></a>
										<ul class="dropdown-menu" aria-labelledby="dropdownMenuLink1">
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#todotaskModal"><i
													class="ri-eye-fill align-bottom me-2 text-muted"></i> View</a>
											</li>
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#todotaskModal"><i
													class="ri-edit-2-line align-bottom me-2 text-muted"></i>
												Edit</a></li>
											<li><a class="dropdown-item" data-bs-toggle="modal" th:attr="data-todono=${vo.todoNo}"
												   href="#deleteRecordModal"><i
													class="ri-delete-bin-5-line align-bottom me-2 text-muted"></i>
												Delete</a></li>
										</ul>
									</div>
								</div>
								<p class="text-muted" th:value="${vo.description}">[[${vo.description}]]</p>
								<div class="mb-3">
									<div class="d-flex mb-1">
										<div class="flex-grow-1">
											<h6 class="text-muted mb-0"><span class="text-secondary">100%</span> of 100%
											</h6>
										</div>
										<div class="flex-shrink-0">
											<span class="text-muted" th:value="${vo.endDate}">[[${vo.endDate}]]</span>
										</div>
									</div>
									<div class="progress rounded-3 progress-sm">
										<div class="progress-bar bg-dark" role="progressbar" style="width: 100%"
											 aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
									</div>
								</div>
							</div>
							<!--end card-body-->
						</div>
					</div>
					<!--end tasks-->
				</div>
			</div>
		</div>
		<!--end task-board-->

		<div class="modal fade" id="creatertaskModal" tabindex="-1" aria-labelledby="creatertaskModalLabel"
			aria-hidden="true">
			<form action="privateTodoWrite" method="post">
				<input type="hidden" name="userNo" th:value="${session.user.userNo}">
			<div class="modal-dialog modal-dialog-centered modal-lg">
				<div class="modal-content border-0">
					<div class="modal-header p-3 bg-soft-info">
						<h5 class="modal-title" id="creatertaskModalLabel">TODO 등록</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<form action="#">
							<div class="row g-3">
								<div class="col-lg-12">
									<label for="projectName" class="form-label">title</label>
									<input type="text" class="form-control" id="projectName"
										placeholder="TODO TITLE" name="title">
								</div>
								<!--end col-->
								<div class="col-lg-12">
									<label for="task-description" class="form-label">Description</label>
									<textarea class="form-control" id="task-description" rows="3"
										placeholder="TODO Description" name="description"></textarea>
								</div>
								<!--end col-->
								<div class="mt-4">
									<div class="hstack gap-2 justify-content-end">
										<button type="button" class="btn btn-light"
											data-bs-dismiss="modal">Close</button>
										<button type="submit" class="btn btn-success">ADD TODO</button>
									</div>
								</div>
								<!--end col-->
							</div>
							<!--end row-->
						</form>
					</div>
				</div>
			</div>
			</form>
		</div>
		<!--end add board modal-->
		<!--━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━-->
		<div class="modal fade" id="todotaskModal" tabindex="-1" aria-labelledby="todotaskModalLabel"
			 aria-hidden="true">
				<input type="hidden" name="todoNo">
				<input type="hidden" name="userNo" th:value="${session.user.userNo}">
				<div class="modal-dialog modal-dialog-centered modal-lg">
					<div class="modal-content border-0">
						<div class="modal-header p-3 bg-soft-info">
							<h5 class="modal-title" id="todotaskModalLabel">TODO 등록</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
								<div class="row g-3">
									<div class="col-lg-12">
										<label for="projectName" class="form-label">title</label>
										<input type="text" class="form-control" id="title"
											   placeholder="TODO TITLE" name="title">
									</div>
									<!--end col-->
									<div class="col-lg-12">
										<label for="task-description" class="form-label">Description</label>
										<textarea class="form-control" id="description" rows="3"
												  placeholder="TODO Description" name="description"></textarea>
									</div>
									<div class="col-lg-6">
										<label for="choices-privacy-status-input" class="form-label">Status</label>
										<select class="form-select" data-choices
												id="choices-privacy-status-input" name="status">
											<option value="0">진행전</option>
											<option value="2">진행중</option>
											<option value="4">완료</option>
										</select>
									</div>
									<!--end col-->
									<div class="mt-4">
										<div class="hstack gap-2 justify-content-end">
											<button type="button" class="btn btn-light"
													data-bs-dismiss="modal">Close</button>
											<button class="btn btn-success" id="todoUpdate">UPDATE TODO</button>
										</div>
									</div>
									<!--end col-->
								</div>
								<!--end row-->
						</div>
					</div>
				</div>
		</div>
		<!--━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━-->

		<div class="modal fade zoomIn" id="deleteRecordModal" tabindex="-1" aria-hidden="true">
				<input type="hidden" name="todoNo">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
							id="delete-btn-close"></button>
					</div>
					<div class="modal-body">
						<div class="mt-2 text-center">
							<lord-icon src="https://cdn.lordicon.com/gsqxdxog.json" trigger="loop"
								colors="primary:#f7b84b,secondary:#f06548" style="width:100px;height:100px"></lord-icon>
							<div class="mt-4 pt-2 fs-15 mx-4 mx-sm-5">
								<h4>Are you sure ?</h4>
								<p class="text-muted mx-4 mb-0">Are you sure you want to remove this tasks ?</p>
							</div>
						</div>
						<div class="d-flex gap-2 justify-content-center mt-4 mb-2">
							<button type="button" class="btn w-sm btn-light" data-bs-dismiss="modal">Close</button>
							<button type="button" class="btn w-sm btn-danger" id="delete-record">Yes, Delete
								It!</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--end modal -->
	</div>


	<th:block layout:fragment="modal">

	</th:block>
/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */

	<th:block layout:fragment="pagejs">
		<script>
			let todoNo;
			// 개인 - 할일 보기
			const selectOne = function (e) {
				e.stopPropagation();
				const target = e.target;
				if (target.tagName === 'A') {
					todoNo = target.getAttribute("data-todono");
				}
				const xhr = new XMLHttpRequest();
				xhr.open('GET', '/private/privateTodoSelectOne/' + todoNo);
				xhr.send();
				xhr.onload = function () {
					if (xhr.status === 200) {
						const result = JSON.parse(xhr.responseText);

						const title = document.querySelector('#title');
						const description = document.querySelector('#description');
						const status = document.querySelector('#choices-privacy-status-input');

						title.value = result.title;
						description.value = result.description;
						status.value = result.status;
					}
				}
			};

			// 개인 - 할일 수정
			const todoupdate = function () {
				const todono = todoNo
				const title = document.querySelector('#title').value;
				const description = document.querySelector('#description').value;
				const status = document.querySelector('#choices-privacy-status-input').value;

				const todoData = {
					todoNo : todono,
					title: title,
					description: description,
					status: status
				};
				const jsonData = JSON.stringify(todoData);

				const xhr = new XMLHttpRequest();
				xhr.open('PATCH', '/private/privateTodoUpdate/' + todoNo);
				xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
				xhr.send(jsonData);

				$('#todotaskModal').modal('hide');

				xhr.addEventListener('load', function () {
					if (xhr.status === 200) {
						window.location.href = '/private/privatetodolist';
					}
				});
			};

			// 모달 열기와 닫기 이벤트 처리
			const buttons = document.querySelectorAll('.dropdown-item[data-bs-toggle="modal"]');
			buttons.forEach(function (button) {
				button.addEventListener('click', function (e) {
					selectOne(e);
				});
			});

			document.querySelector('#todoUpdate').addEventListener('click', function () {
				if (todoNo) {
					todoupdate();
					$('#todotaskModal').modal('hide');
					window.location.href = '/private/privatetodolist';
				}
			});

			// 개인 - 할 일 삭제
			const todoDelete = function (e) {
				e.stopPropagation();
				const target = e.target;
				if (target.tagName === 'A') {
					todoNo = target.getAttribute("data-todono");
				}
			};
			document.querySelector('#delete-record').addEventListener('click', function () {
				if (todoNo) {
					const xhr = new XMLHttpRequest();
					xhr.open('DELETE', '/private/privateDelete/' + todoNo);
					xhr.send();

					$('#deleteRecordModal').modal('hide');

					xhr.addEventListener('load', function () {
						if (xhr.status === 200) {
							window.location.href = '/private/privatetodolist';
						}
					});
				}
			});
			document.querySelectorAll('.dropdown-item').forEach(function (button) {
				button.addEventListener('click', todoDelete);
			});

		</script>

		<!-- dragula init js -->
		<script src="/assets/libs/dragula/dragula.min.js"></script>

		<!-- dom autoscroll -->
		<script src="/assets/libs/dom-autoscroller/dom-autoscroller.min.js"></script>

	</th:block>
</body>

</html>